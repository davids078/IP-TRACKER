<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>IP Address Tracker</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const { useState, useEffect } = React;
    
    // Lucide React icons as inline SVG components
    const Monitor = () => (
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <rect width="20" height="14" x="2" y="3" rx="2"/>
        <line x1="8" x2="16" y1="21" y2="21"/>
        <line x1="12" x2="12" y1="17" y2="21"/>
      </svg>
    );

    const Wifi = () => (
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <path d="M12 20h.01"/>
        <path d="M2 8.82a15 15 0 0 1 20 0"/>
        <path d="M5 12.859a10 10 0 0 1 14 0"/>
        <path d="M8.5 16.429a5 5 0 0 1 7 0"/>
      </svg>
    );

    const AlertCircle = () => (
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <circle cx="12" cy="12" r="10"/>
        <line x1="12" x2="12" y1="8" y2="12"/>
        <line x1="12" x2="12.01" y1="16" y2="16"/>
      </svg>
    );

    const History = () => (
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/>
        <path d="M3 3v5h5"/>
        <path d="M12 7v5l4 2"/>
      </svg>
    );

    const Trash2 = () => (
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <path d="M3 6h18"/>
        <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/>
        <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/>
        <line x1="10" x2="10" y1="11" y2="17"/>
        <line x1="14" x2="14" y1="11" y2="17"/>
      </svg>
    );

    const Clock = () => (
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <circle cx="12" cy="12" r="10"/>
        <polyline points="12 6 12 12 16 14"/>
      </svg>
    );

    const Play = () => (
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <polygon points="6 3 20 12 6 21 6 3"/>
      </svg>
    );

    const Pause = () => (
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <rect width="4" height="16" x="6" y="4"/>
        <rect width="4" height="16" x="14" y="4"/>
      </svg>
    );

    const Download = () => (
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
        <polyline points="7 10 12 15 17 10"/>
        <line x1="12" x2="12" y1="15" y2="3"/>
      </svg>
    );

    const Upload = () => (
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
        <polyline points="17 8 12 3 7 8"/>
        <line x1="12" x2="12" y1="3" y2="15"/>
      </svg>
    );

    const FileText = () => (
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
        <polyline points="14 2 14 8 20 8"/>
        <line x1="16" x2="8" y1="13" y2="13"/>
        <line x1="16" x2="8" y1="17" y2="17"/>
        <polyline points="10 9 9 9 8 9"/>
      </svg>
    );

    function IPAddressViewer() {
      const [localIPs, setLocalIPs] = useState([]);
      const [loading, setLoading] = useState(true);
      const [error, setError] = useState(null);
      const [ipHistory, setIpHistory] = useState([]);
      const [duplicateAlert, setDuplicateAlert] = useState(null);
      const [autoRefresh, setAutoRefresh] = useState(false);
      const [refreshInterval, setRefreshInterval] = useState(30000);
      const [countdown, setCountdown] = useState(0);
      const [customMinutes, setCustomMinutes] = useState('');
      const [uploadError, setUploadError] = useState(null);
      const fileInputRef = React.useRef(null);
      const [showPushNotification, setShowPushNotification] = useState(true);
      const [notificationPermission, setNotificationPermission] = useState('default');

      // Load history from localStorage on mount
      useEffect(() => {
        const savedHistory = localStorage.getItem('ipHistory');
        if (savedHistory) {
          try {
            const parsed = JSON.parse(savedHistory);
            setIpHistory(parsed);
          } catch (err) {
            console.error('Error loading history from localStorage:', err);
          }
        }
        setLoading(false);
        
        // Check notification permission status
        if ('Notification' in window) {
          setNotificationPermission(Notification.permission);
        }

        // Load auto-refresh settings
        const savedAutoRefresh = localStorage.getItem('autoRefresh');
        const savedRefreshInterval = localStorage.getItem('refreshInterval');
        const savedShowNotification = localStorage.getItem('showPushNotification');
        
        if (savedAutoRefresh !== null) {
          setAutoRefresh(savedAutoRefresh === 'true');
        }
        if (savedRefreshInterval !== null) {
          setRefreshInterval(parseInt(savedRefreshInterval));
        }
        if (savedShowNotification !== null) {
          setShowPushNotification(savedShowNotification === 'true');
        }
      }, []);

      // Save history to localStorage whenever it changes
      useEffect(() => {
        if (ipHistory.length > 0) {
          localStorage.setItem('ipHistory', JSON.stringify(ipHistory));
        }
      }, [ipHistory]);

      // Save auto-refresh settings
      useEffect(() => {
        localStorage.setItem('autoRefresh', autoRefresh.toString());
      }, [autoRefresh]);

      useEffect(() => {
        localStorage.setItem('refreshInterval', refreshInterval.toString());
      }, [refreshInterval]);

      useEffect(() => {
        localStorage.setItem('showPushNotification', showPushNotification.toString());
      }, [showPushNotification]);

      useEffect(() => {
        let intervalId;
        let countdownId;

        if (autoRefresh) {
          setCountdown(refreshInterval / 1000);
          
          intervalId = setInterval(() => {
            getLocalIPs();
            setCountdown(refreshInterval / 1000);
          }, refreshInterval);

          countdownId = setInterval(() => {
            setCountdown(prev => {
              if (prev <= 1) {
                return refreshInterval / 1000;
              }
              return prev - 1;
            });
          }, 1000);
        }

        return () => {
          if (intervalId) clearInterval(intervalId);
          if (countdownId) clearInterval(countdownId);
        };
      }, [autoRefresh, refreshInterval]);

      const requestNotificationPermission = async () => {
        if ('Notification' in window && Notification.permission === 'default') {
          const permission = await Notification.requestPermission();
          setNotificationPermission(permission);
          return permission;
        }
        return Notification.permission;
      };

      const showPushNotificationAlert = (ip, previousDate) => {
        if (!showPushNotification) return;
        
        if ('Notification' in window && Notification.permission === 'granted') {
          const notification = new Notification('‚ö†Ô∏è IP Address Already Used', {
            body: `IP: ${ip}\nPreviously detected: ${previousDate}`,
            icon: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="50" cy="50" r="45" fill="%23ef4444"/><text x="50" y="70" font-size="60" text-anchor="middle" fill="white">‚ö†Ô∏è</text></svg>',
            badge: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="50" cy="50" r="45" fill="%23ef4444"/></svg>',
            tag: 'ip-duplicate-' + ip,
            requireInteraction: true
          });

          notification.onclick = () => {
            window.focus();
            notification.close();
          };
        }
      };

      const saveToHistory = (ips) => {
        const timestamp = new Date().toISOString();
        const newEntries = ips.map(ip => ({
          ip,
          timestamp,
          type: ip.includes(':') ? 'IPv6' : 'IPv4'
        }));

        const updatedHistory = [...ipHistory];
        const duplicates = [];
        
        for (const entry of newEntries) {
          const exists = updatedHistory.find(h => h.ip === entry.ip);
          if (exists) {
            duplicates.push({
              ip: entry.ip,
              previousDate: formatDate(exists.timestamp)
            });
            
            // Show push notification for duplicate
            showPushNotificationAlert(entry.ip, formatDate(exists.timestamp));
          } else {
            updatedHistory.unshift(entry);
          }
        }

        if (duplicates.length > 0) {
          setDuplicateAlert(duplicates);
          setTimeout(() => setDuplicateAlert(null), 10000);
        }

        setIpHistory(updatedHistory);
      };

      const downloadHistory = () => {
        if (ipHistory.length === 0) {
          alert('No IP history to download');
          return;
        }

        const dataStr = JSON.stringify(ipHistory, null, 2);
        const blob = new Blob([dataStr], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const link = document.createElement('a');
        const timestamp = new Date().toISOString().replace(/[:.]/g, '-');
        link.href = url;
        link.download = `ip-history-${timestamp}.json`;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        URL.revokeObjectURL(url);
      };

      const uploadHistory = (event) => {
        const file = event.target.files[0];
        if (!file) return;

        setUploadError(null);

        if (!file.name.endsWith('.json')) {
          setUploadError('Please upload a JSON file');
          return;
        }

        const reader = new FileReader();
        reader.onload = (e) => {
          try {
            const content = e.target.result;
            const parsed = JSON.parse(content);

            // Validate the structure
            if (!Array.isArray(parsed)) {
              setUploadError('Invalid file format: Expected an array');
              return;
            }

            // Validate each entry has required fields
            const isValid = parsed.every(entry => 
              entry.ip && entry.timestamp && entry.type
            );

            if (!isValid) {
              setUploadError('Invalid file format: Missing required fields (ip, timestamp, type)');
              return;
            }

            // Merge with existing history, avoiding duplicates
            const mergedHistory = [...ipHistory];
            let addedCount = 0;

            for (const entry of parsed) {
              const exists = mergedHistory.find(h => 
                h.ip === entry.ip && h.timestamp === entry.timestamp
              );
              if (!exists) {
                mergedHistory.push(entry);
                addedCount++;
              }
            }

            // Sort by timestamp (newest first)
            mergedHistory.sort((a, b) => 
              new Date(b.timestamp) - new Date(a.timestamp)
            );

            setIpHistory(mergedHistory);
            alert(`‚úì Successfully loaded ${addedCount} IP entries!\nTotal history: ${mergedHistory.length} entries`);
            
          } catch (err) {
            setUploadError(`Error parsing file: ${err.message}`);
          }
        };

        reader.onerror = () => {
          setUploadError('Error reading file');
        };

        reader.readAsText(file);
        
        // Reset file input
        event.target.value = '';
      };

      const triggerFileUpload = () => {
        fileInputRef.current?.click();
      };

      const clearHistory = () => {
        if (confirm('Are you sure you want to clear all IP history?')) {
          setIpHistory([]);
          localStorage.removeItem('ipHistory');
          setUploadError(null);
        }
      };

      const getLocalIPs = () => {
        setLoading(true);
        setError(null);
        setLocalIPs([]);

        const ips = [];
        const RTCPeerConnection = window.RTCPeerConnection || window.mozRTCPeerConnection || window.webkitRTCPeerConnection;

        if (!RTCPeerConnection) {
          setError('WebRTC is not supported in your browser');
          setLoading(false);
          return;
        }

        const pc = new RTCPeerConnection({
          iceServers: [{ urls: 'stun:stun.l.google.com:19302' }]
        });

        pc.createDataChannel('');

        pc.onicecandidate = (event) => {
          if (!event || !event.candidate) {
            setLoading(false);
            if (ips.length === 0) {
              setError('No local IP addresses found. This may be due to browser privacy settings.');
            } else {
              saveToHistory(ips);
            }
            return;
          }

          const candidate = event.candidate.candidate;
          const ipRegex = /([0-9]{1,3}(\.[0-9]{1,3}){3}|[a-f0-9]{1,4}(:[a-f0-9]{1,4}){7})/;
          const match = ipRegex.exec(candidate);

          if (match && match[1]) {
            const ip = match[1];
            if (!ips.includes(ip)) {
              ips.push(ip);
              setLocalIPs([...ips]);
            }
          }
        };

        pc.createOffer()
          .then(offer => pc.setLocalDescription(offer))
          .catch(err => {
            setError('Failed to create peer connection');
            setLoading(false);
          });

        setTimeout(() => {
          pc.close();
        }, 2000);
      };

      const formatDate = (timestamp) => {
        const date = new Date(timestamp);
        return date.toLocaleString('en-US', {
          month: 'short',
          day: 'numeric',
          year: 'numeric',
          hour: '2-digit',
          minute: '2-digit'
        });
      };

      const formatTime = (seconds) => {
        if (seconds >= 3600) {
          const hrs = Math.floor(seconds / 3600);
          const mins = Math.floor((seconds % 3600) / 60);
          const secs = seconds % 60;
          return `${hrs}:${String(mins).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
        } else if (seconds >= 60) {
          const mins = Math.floor(seconds / 60);
          const secs = seconds % 60;
          return `${mins}:${String(secs).padStart(2, '0')}`;
        }
        return `${seconds}s`;
      };

      const timeOptions = [
        { label: '10 sec', value: 10000 },
        { label: '30 sec', value: 30000 },
        { label: '1 min', value: 60000 },
        { label: '3 min', value: 180000 },
        { label: '5 min', value: 300000 },
        { label: '10 min', value: 600000 },
        { label: '15 min', value: 900000 },
        { label: '30 min', value: 1800000 }
      ];

      const handleCustomMinutes = (e) => {
        const value = e.target.value;
        setCustomMinutes(value);
        
        if (value && !isNaN(value) && Number(value) > 0) {
          const minutes = Number(value);
          setRefreshInterval(minutes * 60000);
        }
      };

      return (
        <div className="min-h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 p-4 py-12">
          <div className="max-w-4xl mx-auto">
            <div className="text-center mb-8">
              <div className="inline-block p-4 bg-purple-500/20 rounded-2xl mb-4">
                <div className="w-12 h-12 text-purple-400"><Monitor /></div>
              </div>
              <h1 className="text-5xl font-bold text-white mb-3">IP Address Tracker</h1>
              <p className="text-purple-200">Track and store your IP addresses over time</p>
            </div>

            {/* Auto Refresh Control Panel */}
            <div className="bg-slate-800/50 backdrop-blur-lg rounded-2xl shadow-2xl overflow-hidden border border-slate-700 mb-6">
              <div className="bg-gradient-to-r from-emerald-600 to-teal-600 p-4">
                <h2 className="text-xl font-bold flex items-center space-x-2 text-white">
                  <div className="w-5 h-5"><Clock /></div>
                  <span>Auto Refresh & Notifications</span>
                </h2>
              </div>
              
              <div className="p-6">
                <div className="flex flex-col space-y-4">
                  <div className="flex items-center justify-between">
                    <span className="text-white font-semibold">Auto Refresh</span>
                    <button
                      onClick={() => setAutoRefresh(!autoRefresh)}
                      className={`flex items-center space-x-2 px-4 py-2 rounded-lg font-semibold transition ${
                        autoRefresh 
                          ? 'bg-red-500 hover:bg-red-600 text-white' 
                          : 'bg-emerald-500 hover:bg-emerald-600 text-white'
                      }`}
                    >
                      {autoRefresh ? (
                        <>
                          <div className="w-4 h-4"><Pause /></div>
                          <span>Stop</span>
                        </>
                      ) : (
                        <>
                          <div className="w-4 h-4"><Play /></div>
                          <span>Start</span>
                        </>
                      )}
                    </button>
                  </div>

                  <div className="flex items-center justify-between bg-slate-900/50 rounded-lg p-4 border border-slate-700">
                    <div>
                      <span className="text-white font-semibold block mb-1">Push Notifications</span>
                      <span className="text-slate-400 text-xs">Show browser notification when duplicate IP is detected</span>
                      {notificationPermission === 'denied' && (
                        <span className="text-red-400 text-xs block mt-1">‚ö†Ô∏è Notifications blocked in browser</span>
                      )}
                      {notificationPermission === 'default' && (
                        <span className="text-yellow-400 text-xs block mt-1">Click to enable notifications</span>
                      )}
                    </div>
                    <button
                      onClick={async () => {
                        if (notificationPermission === 'default') {
                          const permission = await requestNotificationPermission();
                          if (permission === 'granted') {
                            setShowPushNotification(true);
                          }
                        } else {
                          setShowPushNotification(!showPushNotification);
                        }
                      }}
                      disabled={notificationPermission === 'denied'}
                      className={`relative inline-flex h-8 w-14 items-center rounded-full transition-colors ${
                        showPushNotification && notificationPermission === 'granted' ? 'bg-emerald-500' : 'bg-slate-600'
                      } ${notificationPermission === 'denied' ? 'opacity-50 cursor-not-allowed' : ''}`}
                    >
                      <span
                        className={`inline-block h-6 w-6 transform rounded-full bg-white transition-transform ${
                          showPushNotification && notificationPermission === 'granted' ? 'translate-x-7' : 'translate-x-1'
                        }`}
                      />
                    </button>
                  </div>

                  <div>
                    <label className="block text-purple-300 text-sm font-semibold mb-2">
                      Refresh Interval
                    </label>
                    <div className="grid grid-cols-4 gap-2 mb-3">
                      {timeOptions.map((option) => (
                        <button
                          key={option.value}
                          onClick={() => {
                            setRefreshInterval(option.value);
                            setCustomMinutes('');
                          }}
                          className={`px-3 py-2 rounded-lg text-sm font-semibold transition ${
                            refreshInterval === option.value && !customMinutes
                              ? 'bg-emerald-500 text-white'
                              : 'bg-slate-700 text-slate-300 hover:bg-slate-600'
                          }`}
                        >
                          {option.label}
                        </button>
                      ))}
                    </div>
                    
                    <div className="flex items-center space-x-2">
                      <div className="flex-1">
                        <input
                          type="number"
                          min="1"
                          max="1440"
                          placeholder="Custom minutes (1-1440)"
                          value={customMinutes}
                          onChange={handleCustomMinutes}
                          className="w-full px-4 py-2 bg-slate-700 text-white rounded-lg border border-slate-600 focus:border-emerald-500 focus:outline-none placeholder-slate-400"
                        />
                      </div>
                      <span className="text-purple-300 text-sm font-semibold">minutes</span>
                    </div>
                    {customMinutes && !isNaN(customMinutes) && Number(customMinutes) > 0 && (
                      <p className="text-emerald-400 text-xs mt-2">
                        ‚úì Custom interval set: {customMinutes} minute{Number(customMinutes) !== 1 ? 's' : ''}
                      </p>
                    )}
                  </div>

                  {autoRefresh && (
                    <div className="bg-slate-900/50 rounded-lg p-4 border border-emerald-500/30">
                      <div className="flex items-center justify-between">
                        <span className="text-emerald-300 font-semibold">Next refresh in:</span>
                        <span className="text-2xl font-mono font-bold text-emerald-400">
                          {formatTime(countdown)}
                        </span>
                      </div>
                      <div className="mt-2 bg-slate-800 rounded-full h-2 overflow-hidden">
                        <div 
                          className="bg-gradient-to-r from-emerald-500 to-teal-500 h-full transition-all duration-1000"
                          style={{ width: `${(countdown / (refreshInterval / 1000)) * 100}%` }}
                        ></div>
                      </div>
                    </div>
                  )}
                </div>
              </div>
            </div>

            {loading && localIPs.length === 0 && (
              <div className="bg-slate-800/50 backdrop-blur-lg rounded-2xl p-12 text-center border border-slate-700 mb-6">
                <div className="inline-block animate-spin rounded-full h-16 w-16 border-b-4 border-purple-500 mb-4"></div>
                <p className="text-purple-200">Detecting IP addresses...</p>
              </div>
            )}

            {!loading && localIPs.length === 0 && !error && (
              <div className="bg-slate-800/50 backdrop-blur-lg rounded-2xl p-12 text-center border border-slate-700 mb-6">
                <div className="inline-block p-4 bg-purple-500/20 rounded-full mb-4">
                  <div className="w-16 h-16 text-purple-400"><Wifi /></div>
                </div>
                <h3 className="text-2xl font-bold text-white mb-2">Ready to Detect</h3>
                <p className="text-purple-200 mb-6">Click the button below to detect your current IP address</p>
                <button
                  onClick={getLocalIPs}
                  className="bg-gradient-to-r from-purple-600 to-blue-600 text-white py-3 px-8 rounded-xl hover:from-purple-700 hover:to-blue-700 transition font-semibold text-lg"
                >
                  Detect My IP Address
                </button>
              </div>
            )}

            {uploadError && (
              <div className="bg-red-500/10 backdrop-blur-lg border border-red-500/30 rounded-2xl p-6 mb-6">
                <div className="flex items-start space-x-3 text-red-200">
                  <div className="w-6 h-6 flex-shrink-0 mt-1"><AlertCircle /></div>
                  <div>
                    <p className="font-semibold mb-1">Upload Error</p>
                    <p className="text-sm">{uploadError}</p>
                  </div>
                </div>
              </div>
            )}

            {error && (
              <div className="bg-red-500/10 backdrop-blur-lg border border-red-500/30 rounded-2xl p-6 mb-6">
                <div className="flex items-start space-x-3 text-red-200">
                  <div className="w-6 h-6 flex-shrink-0 mt-1"><AlertCircle /></div>
                  <div>
                    <p className="font-semibold mb-1">Error</p>
                    <p className="text-sm">{error}</p>
                  </div>
                </div>
              </div>
            )}

            {duplicateAlert && duplicateAlert.length > 0 && (
              <div className="bg-yellow-500/20 backdrop-blur-lg border-2 border-yellow-500 rounded-2xl p-6 mb-6 animate-pulse">
                <div className="flex items-start space-x-3 text-yellow-100">
                  <div className="w-8 h-8 flex-shrink-0 mt-1 text-yellow-300"><AlertCircle /></div>
                  <div>
                    <p className="font-bold text-xl mb-2 text-yellow-200">‚ö†Ô∏è IP ADDRESS IS USED!</p>
                    {duplicateAlert.map((dup, idx) => (
                      <div key={idx} className="mb-2">
                        <p className="text-yellow-100 font-semibold">IP: {dup.ip}</p>
                        <p className="text-yellow-200 text-sm">Previously detected: {dup.previousDate}</p>
                      </div>
                    ))}
                  </div>
                </div>
              </div>
            )}

            {localIPs.length > 0 && (
              <div className="bg-slate-800/50 backdrop-blur-lg rounded-2xl shadow-2xl overflow-hidden border border-slate-700 mb-6">
                <div className="bg-gradient-to-r from-purple-600 to-blue-600 p-6 text-white">
                  <h2 className="text-2xl font-bold flex items-center space-x-2">
                    <div className="w-6 h-6"><Wifi /></div>
                    <span>Current IP Addresses</span>
                  </h2>
                  <p className="text-purple-100 text-sm mt-1">Currently detected</p>
                </div>

                <div className="p-6 space-y-3">
                  {localIPs.map((ip, index) => (
                    <div key={index} className="bg-slate-900/50 rounded-xl p-5 border border-slate-700">
                      <div className="flex items-center justify-between">
                        <div>
                          <p className="text-purple-400 text-xs uppercase tracking-wide mb-1">
                            {ip.includes(':') ? 'IPv6 Address' : 'IPv4 Address'}
                          </p>
                          <p className="text-white text-2xl font-mono font-bold">{ip}</p>
                        </div>
                        <div className="text-right">
                          <span className="px-3 py-1 bg-green-500/20 text-green-300 rounded-full text-xs font-semibold">
                            Active
                          </span>
                        </div>
                      </div>
                    </div>
                  ))}
                </div>

                <div className="p-4 bg-slate-900/50 border-t border-slate-700">
                  <button
                    onClick={getLocalIPs}
                    className="w-full bg-gradient-to-r from-purple-600 to-blue-600 text-white py-3 px-6 rounded-xl hover:from-purple-700 hover:to-blue-700 transition font-semibold"
                  >
                    Refresh & Save
                  </button>
                </div>
              </div>
            )}

            {ipHistory.length > 0 && (
              <div className="bg-slate-800/50 backdrop-blur-lg rounded-2xl shadow-2xl overflow-hidden border border-slate-700">
                <div className="bg-gradient-to-r from-indigo-600 to-purple-600 p-6 text-white">
                  <div className="flex items-center justify-between flex-wrap gap-4">
                    <div>
                      <h2 className="text-2xl font-bold flex items-center space-x-2">
                        <div className="w-6 h-6"><History /></div>
                        <span>IP Address History</span>
                      </h2>
                      <p className="text-purple-100 text-sm mt-1">{ipHistory.length} unique IPs tracked</p>
                    </div>
                    <div className="flex items-center space-x-2">
                      <button
                        onClick={downloadHistory}
                        className="bg-white/20 hover:bg-white/30 px-4 py-2 rounded-lg transition flex items-center space-x-2"
                        title="Download IP history"
                      >
                        <div className="w-4 h-4"><Download /></div>
                        <span className="text-sm font-semibold">Download</span>
                      </button>
                      <button
                        onClick={triggerFileUpload}
                        className="bg-white/20 hover:bg-white/30 px-4 py-2 rounded-lg transition flex items-center space-x-2"
                        title="Upload IP history"
                      >
                        <div className="w-4 h-4"><Upload /></div>
                        <span className="text-sm font-semibold">Upload</span>
                      </button>
                      <button
                        onClick={clearHistory}
                        className="bg-white/20 hover:bg-white/30 px-4 py-2 rounded-lg transition flex items-center space-x-2"
                        title="Clear all history"
                      >
                        <div className="w-4 h-4"><Trash2 /></div>
                        <span className="text-sm font-semibold">Clear</span>
                      </button>
                    </div>
                  </div>
                </div>

                <div className="p-6 space-y-2 max-h-96 overflow-y-auto">
                  {ipHistory.map((entry, index) => (
                    <div key={index} className="bg-slate-900/50 rounded-lg p-4 border border-slate-700 hover:border-purple-500 transition">
                      <div className="flex items-center justify-between">
                        <div className="flex-1">
                          <p className="text-white font-mono text-lg font-semibold">{entry.ip}</p>
                          <p className="text-slate-400 text-xs mt-1">{formatDate(entry.timestamp)}</p>
                        </div>
                        <span className="px-3 py-1 bg-purple-500/20 text-purple-300 rounded-full text-xs font-semibold">
                          {entry.type}
                        </span>
                      </div>
                    </div>
                  ))}
                </div>
              </div>
            )}

            {/* Hidden file input for upload */}
            <input
              ref={fileInputRef}
              type="file"
              accept=".json"
              onChange={uploadHistory}
              style={{ display: 'none' }}
            />

            {ipHistory.length === 0 && (
              <div className="bg-slate-800/50 backdrop-blur-lg rounded-2xl shadow-2xl overflow-hidden border border-slate-700">
                <div className="bg-gradient-to-r from-indigo-600 to-purple-600 p-6 text-white">
                  <h2 className="text-2xl font-bold flex items-center space-x-2">
                    <div className="w-6 h-6"><History /></div>
                    <span>IP Address History</span>
                  </h2>
                  <p className="text-purple-100 text-sm mt-1">No history yet</p>
                </div>
                
                <div className="p-12 text-center">
                  <div className="inline-block p-4 bg-purple-500/20 rounded-full mb-4">
                    <div className="w-16 h-16 text-purple-400"><FileText /></div>
                  </div>
                  <h3 className="text-xl font-bold text-white mb-2">No IP History</h3>
                  <p className="text-purple-200 mb-6">Start detecting IPs or upload a previous history file</p>
                  <button
                    onClick={triggerFileUpload}
                    className="bg-gradient-to-r from-indigo-600 to-purple-600 text-white py-3 px-6 rounded-xl hover:from-indigo-700 hover:to-purple-700 transition font-semibold inline-flex items-center space-x-2"
                  >
                    <div className="w-5 h-5"><Upload /></div>
                    <span>Upload History File</span>
                  </button>
                </div>
              </div>
            )}

            <div className="mt-6 text-center text-sm text-purple-300">
              <p>üíæ All IP addresses are stored in your browser's localStorage</p>
              <p className="mt-1 text-xs text-purple-400">Data persists across sessions until you clear your browser data</p>
            </div>
          </div>
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<IPAddressViewer />);
  </script>
</body>
</html>
